<div id="loader" ng-if="timeout"></div>
<h5 ng-if="expired">Обявата е изтекла!</h5>
<section ng-if="loaded && !expired" class="advert-page">
  <aside>
    <h5>Информация</h5>
    <div ng-if="advert.payment !== 'Безплатна'" ng-class="{
      pro: advert.payment === 'PRO',
      top: advert.payment === 'TOP',
      vip: advert.payment === 'VIP'
    }" class="side-ribbon left-ribbon">
      <div class="ribbon-text-size">{{advert.payment}}</div>
    </div>
    <div class="advert-info">
      <!-- Organization -->
      <div>
        <span class="bold">Организация:</span>
        <a href="/company/{{advert.companyId}}">{{advert.company}}</a>
      </div>

      <!-- City -->
      <div>
        <span class="bold">Град:</span>
        <span>{{advert.city}}</span>
      </div>

      <!-- Category -->
      <div>
        <span class="bold">Категория:</span>
        <span>{{advert.category}}</span>
      </div>

      <!-- Level -->
      <div>
        <span class="bold">Ниво:</span>
        <span>{{advert.level}}</span>
      </div>

      <!-- Type -->
      <div>
        <span class="bold">Тип:</span>
        <span>{{advert.type}}</span>
      </div>

      <!-- Salary -->
      <div>
        <span class="bold">Заплата:</span>
        <span>от {{advert.salary.min | currency:"лв."}} до {{advert.salary.max | currency:"лв."}}</span>
      </div>

      <!-- Expires -->
      <div>
        <span class="bold">Изтича на:</span>
        <span>{{ now > advert.expirationDate ? 'Изтекла' : (advert.expirationDate | date) }}</span>
      </div>

      <!-- Candidates -->
      <div>
        <span class="bold">Брой кандидатствали:</span>
        <span>{{advert.candidates.length}}</span>
      </div>

      <!-- Views -->
      <div>
        <span class="bold">Брой преглеждания:</span>
        <span>{{advert.views}}</span>
      </div>
    </div>

    <div class="buttons">
      <a href="/advert/{{advert.id}}/edit"
        ng-if="$root.user.id === advert.companyId"
        class="btn btn-primary">Промени обявата</a>

      <!-- Buttons -->
      <button ng-if="$root.user.id === advert.companyId"
              class="btn btn-danger"
              ng-click="deleteAdvert()"
      >Премахни обявата</button>

      <button ng-if="$root.user.role === 'ADMIN'"
              class="btn btn-danger"
              ng-click="blockAdvert()"
      >Блокирай обявата</button>

      <button ng-if="$root.user.role !== 'COMPANY'"
              class="btn btn-primary"
              ng-click="save()"
      >Запази в наблюдавани</button>
      <!-- alert -->
      <div uib-alert 
           ng-repeat="alert in alerts" 
           ng-class="'alert-' + (alert.type || 'warning')" 
           close="closeAlert($index)"
      >{{alert.msg}}</div>

      <button ng-if="$root.user.role !== 'COMPANY'"
              class="btn btn-danger"
              ng-click="reportAdvert()"
      >Съобщи за нередност</button>
    </div>
  </aside>
  <main>
    <div ng-if="advert.img" class="company-picture">
        <img ng-src="{{advert.img}}">
    </div>
    <h1>{{advert.title}}</h1>
    <div class="advert-description">
      <h4>Описание и изисквания:</h4>
      <div ng-bind-html="advert.description" class="discription"></div>
    </div>

    <button class="btn btn-success"
            ng-if="$root.user.role !== 'COMPANY'"
            ng-click="apply()"
    ><b>Кандидатствай</b></button>
    <!-- alert -->
    <div uib-alert 
         ng-repeat="alert in alerts" 
         ng-class="'alert-' + (alert.type || 'warning')" 
         close="closeAlert($index)"
    >{{alert.msg}}</div>
  </main>
</section>
